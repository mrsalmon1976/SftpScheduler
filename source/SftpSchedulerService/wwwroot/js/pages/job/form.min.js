createApp({data(){return{allHosts:[],host:"",isEdit:!1,isLoading:!0,localPrefix:"",localPrefixInWords:"No local prefix entered.",schedule:"",scheduleInWords:"No schedule entered",job:new JobModel,auditLogs:[],logs:[],fileLogs:[],submitButtonText:"Create Job"}},watch:{localPrefix:UiHelpers.debounce(function(){this.updateLocalPrefixText()},500),schedule:UiHelpers.debounce(function(n){var t=this;if(this.job.schedule=this.schedule,this.schedule.trim()==""){t.scheduleInWords="No schedule entered";return}this.scheduleInWords="Loading....";this.job.convertScheduleToWords(n,function(n){t.scheduleInWords=n})},500)},methods:{async executeJob(){await axios.post("/api/jobs/"+this.job.hashId+"/run",this.job).then(()=>{UiHelpers.showSuccessToast("Run Job","","Job "+this.job.name+" has been scheduled for execution")}).catch(n=>{n.response&&n.response.status==400?UiHelpers.showWarningToast("Error","",n.response.data):UiHelpers.showErrorToast("Error","",n.message)})},formatDateTime(n){return UiHelpers.formatDateTime(n)},getLogClass(n){return n.status=="Failed"?"bg-danger":n.status=="Success"?"bg-success":"bg-primary"},isDownloadVisible(){return this.job.type==JobTypes.Download},isUploadVisible(){return this.job.type==JobTypes.Upload},async loadAuditLogs(){let n=await axios.get("/api/jobs/"+this.job.hashId+"/auditlogs").catch(n=>{UiHelpers.showErrorToast("Error","",n.message)});this.auditLogs=n.data},async loadHosts(){let n=await axios.get("/api/hosts").catch(n=>{UiHelpers.showErrorToast("Error","",n.message),this.isLoading=!1});this.allHosts=n.data},async loadJobDetail(){let t=await axios.get("/api/jobs/"+this.job.hashId).catch(n=>{UiHelpers.showErrorToast("Error","",n.message);return});var n=t.data;UiHelpers.setPageHeader("Edit Job / "+n.name);this.job.name=n.name;this.job.hostId=n.hostId;this.job.type=n.type;this.job.localPath=n.localPath;this.job.localPrefix=n.localPrefix;this.localPrefix=n.localPrefix;this.job.localArchivePath=n.localArchivePath;this.job.remotePath=n.remotePath;this.job.deleteAfterDownload=n.deleteAfterDownload;this.job.remoteArchivePath=n.remoteArchivePath;this.job.localCopyPaths=n.localCopyPaths;this.job.isEnabled=n.isEnabled;this.job.restartOnFailure=n.restartOnFailure;this.job.compressionMode=n.compressionMode;this.job.fileMask=n.fileMask;this.job.preserveTimestamp=n.preserveTimestamp;this.job.transferMode=n.transferMode;this.job.validate();this.schedule=n.schedule;Vue.nextTick(function(){$('[data-toggle="tooltip"]').tooltip()})},async loadFileLogs(){let n=await axios.get("/api/jobs/"+this.job.hashId+"/filelogs").catch(n=>{UiHelpers.showErrorToast("Error","",n.message)});this.fileLogs=n.data},async loadLogs(){let n=await axios.get("/api/jobs/"+this.job.hashId+"/logs").catch(n=>{UiHelpers.showErrorToast("Error","",n.message)});this.logs=n.data},onTypeChange(){$('[data-toggle="tooltip"]').tooltip()},setLogReloadInterval(){var n=this;setInterval(function(){n.loadLogs();n.loadFileLogs()},6e4)},async submit(){if(this.isLoading=!0,$("#toastsContainerTopRight > .toast").remove(),!this.job.validate()){this.isLoading=!1;UiHelpers.showErrorToast("Validation Failure","","Job properties missing or incorrect.",1e4);return}var n=this.isEdit?"/api/jobs/"+this.job.hashId:"/api/jobs";await axios.post(n,this.job).then(()=>{window.location.href="/jobs"}).catch(n=>{var i,t;if(n.response&&n.response.data&&n.response.data.errorMessages)for(i=n.response.data.errorMessages,t=0;t<i.length;t++)UiHelpers.showErrorToast("Validation Error","",i[t]);else UiHelpers.showErrorToast("Validation Error","",n.message);this.isLoading=!1})},async updateLocalPrefixText(){if(this.job.localPrefix=this.localPrefix,this.localPrefix.trim()==""){this.localPrefixInWords="No local prefix entered";return}let n=this.localPrefix;const t=moment().format("YYYY"),i=moment().format("MM"),r=moment().format("DD"),u=moment().format("HH"),f=moment().format("mm"),e=moment().format("ss");n=n.replace(/\{year\}/gi,t);n=n.replace(/\{month\}/gi,i);n=n.replace(/\{day\}/gi,r);n=n.replace(/\{hour\}/gi,u);n=n.replace(/\{minute\}/gi,f);n=n.replace(/\{second\}/gi,e);this.localPrefixInWords="Files will be prefixed with the value '"+n+"'"}},mounted:function(){this.isLoading=!0;this.loadHosts();this.job.hashId=this.$el.parentElement.getAttribute("data-job-id");this.job.hashId==""?(UiHelpers.setPageHeader("Create New Job"),Vue.nextTick(function(){$('[data-toggle="tooltip"]').tooltip()})):(this.isEdit=!0,this.submitButtonText="Update Job",this.loadJobDetail(),this.loadLogs(),this.loadFileLogs(),this.loadAuditLogs(),this.setLogReloadInterval());this.updateLocalPrefixText();this.isLoading=!1}}).mount("#app-job");