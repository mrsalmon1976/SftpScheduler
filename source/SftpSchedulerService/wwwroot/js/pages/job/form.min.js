createApp({data(){return{allHosts:[],host:"",isEdit:!1,isLoading:!0,schedule:"",scheduleInWords:"No schedule entered",job:new JobModel,logs:[],submitButtonText:"Create Job"}},watch:{schedule:UiHelpers.debounce(function(n){var t=this;if(this.job.schedule=this.schedule,this.schedule.trim()==""){t.scheduleInWords="No schedule entered";return}this.scheduleInWords="Loading....";this.job.convertScheduleToWords(n,function(n){t.scheduleInWords=n})},500)},methods:{formatDateTime(n){return UiHelpers.formatDateTime(n)},getLogClass(n){return n.status=="Failed"?"bg-danger":n.status=="Success"?"bg-success":"bg-primary"},isDownloadVisible(){return this.job.type==JobTypes.Download},async loadHosts(){let n=await axios.get("/api/hosts").catch(n=>{UiHelpers.showErrorToast("Error","",n.message),this.isLoading=!1});this.allHosts=n.data},async loadJobDetail(){let t=await axios.get("/api/jobs/"+this.job.hashId).catch(n=>{UiHelpers.showErrorToast("Error","",n.message);return});var n=t.data;UiHelpers.setPageHeader("Edit Job / "+n.name);this.job.name=n.name;this.job.hostId=n.hostId;this.job.type=n.type;this.job.localPath=n.localPath;this.job.remotePath=n.remotePath;this.job.deleteAfterDownload=n.deleteAfterDownload;this.job.remoteArchivePath=n.remoteArchivePath;this.job.localCopyPaths=n.localCopyPaths;this.job.isEnabled=n.isEnabled;this.job.validate();this.schedule=n.schedule},async loadLogs(){let n=await axios.get("/api/jobs/"+this.job.hashId+"/logs").catch(n=>{UiHelpers.showErrorToast("Error","",n.message)});this.logs=n.data},setLogReloadInterval(){var n=this;setInterval(function(){n.loadLogs()},6e4)},async submit(){if(this.isLoading=!0,$("#toastsContainerTopRight > .toast").remove(),!this.job.validate()){this.isLoading=!1;UiHelpers.showErrorToast("Validation Failure","","Job properties missing or incorrect.",1e4);return}var n=this.isEdit?"/api/jobs/"+this.job.hashId:"/api/jobs";await axios.post(n,this.job).then(()=>{window.location.href="/jobs"}).catch(n=>{var i,t;if(n.response&&n.response.data&&n.response.data.errorMessages)for(i=n.response.data.errorMessages,t=0;t<i.length;t++)UiHelpers.showErrorToast("Validation Error","",i[t]);else UiHelpers.showErrorToast("Validation Error","",n.message);this.isLoading=!1})}},mounted:function(){this.isLoading=!0;this.loadHosts();this.job.hashId=this.$el.parentElement.getAttribute("data-job-id");this.job.hashId==""?UiHelpers.setPageHeader("Create New Job"):(this.isEdit=!0,this.submitButtonText="Update Job",this.loadJobDetail(),this.loadLogs(),this.setLogReloadInterval());this.isLoading=!1}}).mount("#app-job");